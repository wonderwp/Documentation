# Custom Post

## Generating a custom post type plugin

The generator now supports CPT plugin generation. 

You'll find the command line to execute in the [generator documentation page](../02_Generator.md#page_Generating_a_Custom_Post_Type_plugin).

## Extra files generated for a CPT plugin

In case of a CPT plugin, the generator will generate some extra files and folders compared to the basic plugin architecture : 

- **CPT/**
    - [...]CPT.php _//CityCpt.php if your plugin is called City_ 
- **Repository/**
    - [...]Repository.php _//CityRepository.php if your plugin is called City_
    
### The CPT definition files

This files is where you specify your CPT declaration based on the [register_post_type()](https://developer.wordpress.org/reference/functions/register_post_type/) function.

Here's an example of a CPT file generated by the generator.

```
<?php

namespace Jdmweb\Plugin\City\CPT;

use WonderWp\Component\CPT\CustomPostType;
use function WonderWp\Functions\array_merge_recursive_distinct;

class CityCPT extends CustomPostType
{
    /**
     * CityCPT CPT constructor.
     *
     * @param string $name
     * @param array  $passed_opts CPT options, @see https://developer.wordpress.org/reference/functions/register_post_type/
     * @param string $taxonomy_name
     * @param array  $passed_taxonomy_opts
     */
    public function __construct($name = '', array $passed_opts = [], $taxonomy_name = '', array $passed_taxonomy_opts = [])
    {
        $name        = WWP_PLUGIN_CITY_NAME;
        $defaultOpts = [
            'labels'       => [
                //CPT labels can be edited below
                'name' => ucfirst(__($name, WWP_CITY_TEXTDOMAIN)),
                //'not_found'    => __($name . ' not found', WWP_CITY_TEXTDOMAIN),
                //'add_new_item' => __('Add new ' . $name, WWP_CITY_TEXTDOMAIN),
                //'edit_item'    => __('Edit ' . $name, WWP_CITY_TEXTDOMAIN),
            ],
            'show_in_rest' => true,
            'rewrite'      => ['slug' => __(sanitize_title($name), WWP_CITY_TEXTDOMAIN)],
        ];
        $opts        = array_merge_recursive_distinct($defaultOpts, $passed_opts);
        parent::__construct($name, $opts, $taxonomy_name, $passed_taxonomy_opts);
    }
}

```

This file is then automatically loaded by your plugin manager to register your CPT with WordPress.

### The repository

This file follows the [repository interface](https://github.com/wonderwp/Repository/blob/develop/src/RepositoryInterface.php) implementation and extends the [PostRepository](https://github.com/wonderwp/Repository/blob/develop/src/PostRepository.php) object.

It allows you to make queries to get your custom posts from the database.

#### Examples

##### Getting the repository from the manager 

```
/** @var CityRepository */
$repository = $this->manager->getService(ServiceInterface::ServiceInterface::REPOSITORY_SERVICE_NAME);
```

##### Getting every post

```
$cities = $repository->findAll();
```

##### Getting one post

```
$cityOne = $repository->find(1);
$cityTwo = $repository->find(2);
```

##### Making a specific request

The criterias array is the same than the one you would pass to [WP_Query](https://developer.wordpress.org/reference/classes/wp_query/#parameters) 
```
$criterias = [
  'author' => 123
];
$cities = $repository->findBy($criterias);
```
